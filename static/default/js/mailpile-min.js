function MailPile(){this.msgcache=[];this.searchcache=[]}Number.prototype.pad=function(e){typeof e!="number"&&(e=2);var t=String(this);while(t.length<e)t="0"+t;return t};MailPile.prototype.add=function(){};MailPile.prototype.attach=function(){};MailPile.prototype.compose=function(){};MailPile.prototype.delete=function(){};MailPile.prototype.extract=function(){};MailPile.prototype.filter=function(){};MailPile.prototype.help=function(){};MailPile.prototype.load=function(){};MailPile.prototype.mail=function(){};MailPile.prototype.forward=function(){};MailPile.prototype.next=function(){};MailPile.prototype.order=function(){};MailPile.prototype.optimize=function(){};MailPile.prototype.previous=function(){};MailPile.prototype.print=function(){};MailPile.prototype.reply=function(){};MailPile.prototype.rescan=function(){};MailPile.prototype.gpgrecv=function(e){};MailPile.prototype.gpglistkeys=function(){mailpile.json_get("gpg list",{},function(e){$("#content").append('<div class="dialog" id="gpgkeylist"></div>');for(k in e.results){key=e.results[k];$("#gpgkeylist").append("<li>Key: "+key.uids[0].replace("<","&lt;").replace(">","&gt;")+": "+key.pub.keyid+"</li>")}})};MailPile.prototype.search=function(e){var t=this;$("#qbox").val(e);this.json_get("search",{q:e},function(e){$("#results").length==0&&$("#content").prepend('<table id="results" class="results"><tbody></tbody></table>');$("#results tbody").empty();for(var n=0;n<e.results.length;n++){msg_info=e.results[n];msg_tags=e.results[n].tags;d=new Date(msg_info.date*1e3);zpymd=d.getFullYear()+"-"+(d.getMonth()+1).pad(2)+"-"+d.getDate().pad(2);ymd=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();taghrefs=msg_tags.map(function(e){return"<a onclick=\"mailpile.search('\\"+e+"')\">"+e+"</a>"}).join(" ");tr=$('<tr class="result"></tr>');tr.addClass(n%2==0?"even":"odd");tr.append('<td class="checkbox"><input type="checkbox" name="msg_'+msg_info.id+'"/></td>');tr.append('<td class="from"><a href="'+msg_info.url+'">'+msg_info.from+"</a></td>");tr.append('<td class="subject"><a href="'+msg_info.url+'">'+msg_info.subject+"</a></td>");tr.append('<td class="tags">'+taghrefs+"</td>");tr.append('<td class="date"><a onclick="mailpile.search(\'date:'+ymd+"');\">"+zpymd+"</a></td>");$("#results tbody").append(tr)}t.loglines(e.chatter)})};MailPile.prototype.set=function(e,t){var n=this;this.json_get("set",{args:e+"="+t},function(e){e.status=="ok"?n.notice("Success: "+e.loglines[0]):e.status=="error"&&this.error(e.loglines[0])})};MailPile.prototype.tag=function(e,t){};MailPile.prototype.addtag=function(e){};MailPile.prototype.unset=function(){};MailPile.prototype.update=function(){};MailPile.prototype.view=function(e,t){var n=this;this.json_get("view",{idx:e,msgid:t},function(e){$("#results").length==0&&$("#content").prepend('<table id="results" class="results"><tbody></tbody></table>');$("#results").empty();$that.loglines(e.chatter)})};MailPile.prototype.json_get=function(e,t,n){var r;e=="view"?r="/="+t.idx+"/"+t.msgid+".json":r="/_/"+e+".json";$.getJSON(r,t,n)};MailPile.prototype.loglines=function(e){$("#loglines").empty();for(var t=0;t<e.length;t++)$("#loglines").append(e[t]+"\n")};MailPile.prototype.notice=function(e){console.log("NOTICE: "+e)};MailPile.prototype.error=function(e){console.log("ERROR: "+e)};MailPile.prototype.warning=function(e){console.log("WARNING: "+e)};var mailpile=new MailPile;$(document).ready(function(){function n(e){var t=document.getElementById(e);t.focus();if(t.setSelectionRange){var n=2*t.value.length;t.setSelectionRange(n,n)}else t.value=t.value}$("#search-params, #bulk-actions").hide();$("#qbox").jkey("enter, return",function(e){console.log("Search query submitted");$("#search-params").slideDown("fast")});$(".bulk-action").on("click",function(e){e.preventDefault();var t=$("#pile-results input[type=checkbox]"),n=$(this).attr("href"),r=0;$.each(t,function(){if($(this).val()==="selected"){console.log("This is here "+$(this).attr("name"));r++}});alert(r+' items selected to "'+n.replace("#","")+'"')});var e=function(e){$("#bulk-actions-selected-count").html(parseInt($("#bulk-actions-selected-count").html())+1);$("#bulk-actions").slideDown("fast");e.removeClass("result").addClass("result-on").data("state","selected").find("td.checkbox input[type=checkbox]").val("selected").prop("checked",!0)},t=function(e){var t=parseInt($("#bulk-actions-selected-count").html())-1;$("#bulk-actions-selected-count").html(t);t<1&&$("#bulk-actions").slideUp("fast");e.removeClass("result-on").addClass("result").data("state","normal").find("td.checkbox input[type=checkbox]").val("normal").prop("checked",!1)};$("#pile-results").on("click","tr",function(){$(this).data("state")==="selected"?t($(this)):e($(this))})});